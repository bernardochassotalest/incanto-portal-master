import _ from 'lodash';
import fs from 'fs';
import path from 'path';
import { format, parseISO, getDay, setHours, subDays, lastDayOfMonth } from 'date-fns';
import puppeteer from 'puppeteer';
import stream from 'stream';
import { postgres } from 'models';
import { formats } from 'commons/helper';

const logoPalmeiras = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkNhbWFkYV8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgd2lkdGg9IjMwMHB4IiBoZWlnaHQ9IjMwMHB4IiB2aWV3Qm94PSIwIDAgMzAwIDMwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMzAwIDMwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8Zz4NCgk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI0ZGRkZGRiIgZD0iTTE1MCwwLjVjODIuNTY2LDAsMTQ5LjUsNjYuOTM1LDE0OS41LDE0OS41MDINCgkJYzAsODIuNTY0LTY2LjkzNCwxNDkuNDk4LTE0OS41LDE0OS40OThTMC41LDIzMi41NjYsMC41LDE1MC4wMDJDMC41LDY3LjQzNSw2Ny40MzQsMC41LDE1MCwwLjUiLz4NCgk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iIzAwNjQzNyIgZD0iTTE1MCw4LjQ5OWM3OC4xNDksMCwxNDEuNDk5LDYzLjM1NCwxNDEuNDk5LDE0MS41DQoJCWMwLDc4LjE1Mi02My4zNSwxNDEuNTA1LTE0MS40OTksMTQxLjUwNUM3MS44NTEsMjkxLjUwNSw4LjUsMjI4LjE1MSw4LjUsMTUwQzguNSw3MS44NTMsNzEuODUxLDguNDk5LDE1MCw4LjQ5OSBNMTUwLDQuNzU3DQoJCWM4MC4yMTMsMCwxNDUuMjQxLDY1LjAyOCwxNDUuMjQxLDE0NS4yNDJjMCw4MC4yMTYtNjUuMDI4LDE0NS4yNDYtMTQ1LjI0MSwxNDUuMjQ2QzY5Ljc4MywyOTUuMjQ1LDQuNzU5LDIzMC4yMTYsNC43NTksMTUwDQoJCUM0Ljc1OSw2OS43ODUsNjkuNzgzLDQuNzU3LDE1MCw0Ljc1NyIvPg0KCTxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBmaWxsPSIjMDA2NDM3IiBkPSJNMjIxLjI1OCw0Ny4xNjFsMS42OCwzLjg5OGwtMi44NjYsMy4xMmw0LjIwMy0wLjQwMmwyLjA2NywzLjcwNQ0KCQlsMC45MTctNC4xNDZsNC4xNDQtMC44MzNsLTMuNjM5LTIuMTZsMC40OTItNC4yMmwtMy4xNjUsMi44MTRMMjIxLjI1OCw0Ny4xNjF6IE0yMzMuNjExLDYxLjAwNWwxLjE2NSw1LjEwN2wtNC4xNzQsMy4xMzINCgkJbDUuMTg5LDAuNDY3bDEuNjcsNC45NThsMi4wNDUtNC44MTlsNS4yMS0wLjA2OGwtMy45MjgtMy40NDNsMS41NDQtNS4wMDJsLTQuNDY3LDIuNjkxTDIzMy42MTEsNjEuMDA1eiBNMjQ0LjE4Niw3OC43MzUNCgkJbDAuMDc0LDYuNzUybC02LjExMSwyLjgwMWw2LjQwNywyLjAxM2wwLjc1OSw2LjcxM2wzLjg4Ni01LjUwOGw2LjU3OCwxLjM0OGwtNC4wMDYtNS40MTlsMy4zMDgtNS44NzZsLTYuMzYyLDIuMTU4TDI0NC4xODYsNzguNzM1DQoJCXogTTI1MS43NTYsMTAxLjQyNmwtMi4wNDMsOC4zODJsLTguNDUxLDEuNTFsNy4yOTgsNC41NDdsLTEuMTg2LDguNTQ0bDYuNTUxLTUuNTcxbDcuNzE4LDMuNzczbC0zLjI0Mi03Ljk5bDUuOTUzLTYuMjE2DQoJCWwtOC41NiwwLjYzN0wyNTEuNzU2LDEwMS40MjZ6IE00OC4yMTksMTAxLjQyNmwyLjA0NCw4LjM4Mmw4LjQ1LDEuNTFsLTcuMjkzLDQuNTQ3bDEuMTgzLDguNTQ0bC02LjU1LTUuNTcxbC03LjcxOCwzLjc3Mw0KCQlsMy4yNDQtNy45OWwtNS45NTQtNi4yMTZsOC41NTgsMC42MzdMNDguMjE5LDEwMS40MjZ6IE01NS43OTIsNzguNzM1bC0wLjA3NCw2Ljc1Mmw2LjExLDIuODAxbC02LjQwOCwyLjAxM2wtMC43NTcsNi43MTMNCgkJbC0zLjg4NS01LjUwOEw0NC4yLDkyLjg1NGw0LjAwNi01LjQxOWwtMy4zMDktNS44NzZsNi4zNjIsMi4xNThMNTUuNzkyLDc4LjczNXogTTY2LjM2NSw2MS4wMDVsLTEuMTY0LDUuMTA3bDQuMTczLDMuMTMyDQoJCWwtNS4xODgsMC40NjdsLTEuNjcyLDQuOTU4bC0yLjA0NC00LjgxOWwtNS4yMDgtMC4wNjhsMy45MjUtMy40NDNsLTEuNTQ0LTUuMDAybDQuNDY4LDIuNjkxTDY2LjM2NSw2MS4wMDV6IE03OC43MjIsNDcuMTYxDQoJCWwtMS42OCwzLjg5OGwyLjg2NSwzLjEybC00LjIwNC0wLjQwMmwtMi4wNjcsMy43MDVsLTAuOTE3LTQuMTQ2bC00LjE0Mi0wLjgzM2wzLjYzOC0yLjE2bC0wLjQ5NS00LjIybDMuMTY2LDIuODE0TDc4LjcyMiw0Ny4xNjF6DQoJCSBNMjM4LjE2NSwxNDMuMDM3YzEuMTE4LTIuNDIxLDIuMTA4LTQuOTQ0LDMuMDY3LTcuNTYyYy0yLjYyMi0wLjQ2NC00LjczNy0wLjgzNC02Ljc4Mi0xLjE5N2MtNC45NS0wLjc5My04LjIxNiwwLjgzNC05LjgyNCwzLjAwOQ0KCQljLTEuNjEyLDIuMTc3LTIuNjE2LDQuMjI5LTMuNzg2LDcuMTk0Yy0xLjE3LDIuOTY0LTEuMDk5LDguMzkxLDcuMjYsMTIuMTE2YzcuMjc4LDMuMzYxLDEyLjczNCw2LjcxNywyNC4yODUtMy4xNDINCgkJYzYuNzctNS40NSw5LjM0Ny0zLjYwNywxMS44MjItMy4wOTdjMy41NDIsMS4xOTEsMy45MTMsMi42MjUsMy4yMjEsNi4zNDRjLTAuOTI4LDQuNTk3LTYuMTIyLDIuMTU3LTguNjE4LDEuMTc2DQoJCWMtMC45NTYsMy42NTctMS45Niw2LjQ2Mi0zLjU3MiwxMC40MDRjMS41MSwwLjYzMywzLjM5NCwxLjQ4OSw1LjA4NywyLjIwM2M3LjY5NywzLjA4NiwxNi4zNzksMS40MTEsMTguMzk2LTcuOTA4DQoJCWMxLjIwOC02LjI1OSwwLjg0LTkuMzA1LDAuODQtMTAuMzkzYy0wLjExLTUuNzkxLTQuMzY4LTEwLjkzNi0xMS43NC0xMi4yNjJjLTcuMTkxLTEuNDQ0LTExLjk5LTEuODM5LTIyLjA1LDUuNzI4DQoJCWMtNS4xNjIsMy44MjctNi4wMTgsNS4yNzEtMTAuNjk4LDMuNDEzYy0yLjQ5Mi0wLjk0NS00Ljg4MS0xLjc4NS0zLjQ4NS00LjcwNEMyMzIuNjUxLDE0Mi4xMiwyMzMuNzU1LDE0MS43MzgsMjM4LjE2NSwxNDMuMDM3DQoJCSBNMjIzLjkxOCwxNzEuMjQ5bDIyLjYsOS4yN2MtMS43NTUsMy41MTUtMi42Miw1LjMwNS01LjAzNCw4LjkyM0wyMjMuOTE4LDE3MS4yNDl6IE0yMTEuNzk3LDE1Ni43NzQNCgkJYy0xLjkxNSwyLjAxLTMuODksNC4xMDctNi4xNjgsNi4wODRsNDkuMDg2LDYxLjYxOGMyLjk0Ni00LjAzNSw1Ljk2OS04Ljg3Myw4LjUwMS0xMy4zODFsLTEzLjQyNy0xMy40DQoJCWMyLjg5LTQuNjg4LDQuMTQ2LTcuMzY5LDYuNTA4LTEyLjg1bDE1LjI3Myw2LjY2MWMxLjcxNy00LjQzMiwzLjA0My04LjQ4NSwzLjk2OS0xMi43NTZMMjExLjc5NywxNTYuNzc0eiBNMjA2Ljk0MSwyMDcuNzc5DQoJCWM1LjM5Ny0zLjUwNCw4LjY2Ni02LjI2MSwyLjAwNC0xNC4wNjlsLTcuNDMyLTkuMzc1Yy00LjUzNi02LjE5NC03LjE4MS0yLjg0NS0xMC41NzktMS4yODRMMjA2Ljk0MSwyMDcuNzc5eiBNMjE4LjM1MiwyNTguOTkNCgkJbC0zOS4yMTMtODAuMTYzYzUuMDM2LTEuODQ1LDkuMjk4LTMuOTQ3LDEzLjU1OS02LjQ2OWM1LjM5Ny0zLjQ3Niw5LjksMC4wNSwxNC40MzEsNC4yMzNsMTEuNDYxLDEwLjY1OQ0KCQljMTAuODYsMTAuMTA0LDguODk1LDE3LjYzOSw2LjQ4NCwyMC4wNjZsMjguNTA1LDE4LjcyNWMtMy4wODgsNC4yNjgtNi4xMjgsOC4wMDctOS41NiwxMS41NjRsLTI3LjgyMS0yMi40N2wtMy4yNDMsMi4xOTUNCgkJbDIwLjc2NCwzMC4zNjhDMjI5LjIxMSwyNTEuNjQ3LDIyMy41MTUsMjU1Ljc5NCwyMTguMzUyLDI1OC45OSBNMTY4Ljc4OCwxODEuOTU4YzIuODU0LTAuNjc2LDQuNzI1LTEuMTg2LDcuNDEzLTIuMDc3DQoJCWwzNi42MTYsODIuNDQ4Yy00Ljk1OSwyLjcxMy0xMS4wNDksNS43MTEtMTcuMTg4LDguMDA2TDE2OC43ODgsMTgxLjk1OHogTTE2Ni4wMiwxODIuNTIzYy01LjczNCwxLjAxNi05LjAyNiwxLjQ0My0xNi41MTcsMS41MDQNCgkJbC0xLjk0Myw5NC41MDZjMTQuNzM2LDAuMzkyLDI5LjcyMS0yLjAxNiw0Mi40Mi02LjI0OWwtNC4yMy0xNS45NjljLTYuNzk5LDIuMTgtMTMuNDMsMy44LTIwLjAzOCw0LjM5NGwtMy43NDgtMzIuMjc4DQoJCWM2LjgzNy0wLjczLDEwLjU2NS0xLjU1NCwxNS40MzgtMy4xNDJsLTMuMjQyLTEyLjAxOWMtNC41NDIsMS4zMDctOC44OTYsMi4wMDktMTMuNjU0LDIuNTUzbC0yLjYzNi0yMi44MTENCgkJYzMuNTYxLTAuMTA1LDcuMjg5LTAuNzI2LDEwLjU3My0xLjU2MUwxNjYuMDIsMTgyLjUyM3ogTTc2Ljk5NiwyNTUuNjEzbDQyLjE4Ny03Ny41MzhjMi40NzcsMS4wMjEsNS4yOTMsMS45MjcsNy44MDEsMi42NzQNCgkJbC00LjYyNSwzOS45MzhjMS4yNi0yLjg4NywxNS42NjEtMzcuNDEyLDE1LjY2MS0zNy41NmMyLjE5NywwLjM1Niw2LjM4MiwwLjczNSw4LjIxNywwLjgxM2wtNS42NzEsOTQuMjU4DQoJCWMtNC44My0wLjEzMS0xMi4yODEtMS4yNTEtMTcuNTQ5LTIuNDk4bDguMDQ5LTQ3LjU3MWwtMjAuMjQ0LDMyLjQ4NmwtMC41MTMtMzkuNTA1Yy0xLjY3Niw1LjAxLTE4LjQxMSw0My4zMjEtMTguNDExLDQzLjQ2NA0KCQlDODUuOTA4LDI2MS41MTEsODEuMDExLDI1OC40NDYsNzYuOTk2LDI1NS42MTMgTTUwLjEzNywyMzAuNTIybDU0LjQ1OS02MC4xMDJjLTAuMjA1LTAuMDUsNC45MjMsMy4xMDYsNy4zODYsNC4zNTlsLTQyLjA1NSw1NS43ODENCgkJYzQuNCw0LjM2NSw2LjA2NSw1Ljc0NCwxMS40MjYsOS43NzRsLTcuNjIyLDEyLjk0OUM2NS43MzQsMjQ3LjUyOSw1NS4yNCwyMzcuMzA1LDUwLjEzNywyMzAuNTIyIE03OS4wMjUsMTcyLjM0MmwtMjQuMzMzLDEwLjE1Mw0KCQljMS44MjcsMy41ODEsMy41ODQsNi4zNzUsNi4wMjgsOS42MTJMNzkuMDI1LDE3Mi4zNDJ6IE04OS42MTksMTU3LjkyM2MxLjk2OSwyLjA1Myw0LjQwNSw0LjM3LDYuODA4LDYuNDA3TDQ4LjQsMjI4LjM4OA0KCQljLTMuMDc0LTQuMDE1LTYuMjQ1LTguNzYtOC44NTQtMTMuMTYybDEzLjQ1Ni0xNC41MmMtMi45NjUtNC40NzEtNS41OTEtOC4yNjctOC4wMTgtMTMuOTYxbC0xNS41NjcsNi44NTUNCgkJYy0xLjczMi00LjUyMS0zLjE5NC05LjUyOS0zLjkxNC0xMi45OTRMODkuNjE5LDE1Ny45MjN6IE02Ny44MDYsMTQyLjI1NGwtMTcuMjUzLDQuNjg3YzAuMjA5LDEuNTEzLDAuNDc4LDIuNjQ1LDAuOTM0LDQuMTU4DQoJCWMxLjI1Miw0LjEzNCwzLjE4Nyw0LjA2Nyw4LjA0MiwyLjI5OGw2LjMxMS0yLjM1NWMyLjUyNy0xLjEyOSw1LjA1MS0yLjI2NiwzLjcyLTUuMTQ2DQoJCUM2OC42OTMsMTQ0LjMyMiw2Ny44MDYsMTQyLjE3NSw2Ny44MDYsMTQyLjI1NCBNNzMuMjUzLDEzMi41ODdjMS4wOTcsMi44NjYsNC4zNDcsOS4xMTYsNS42OCwxMS4xODgNCgkJYzMuMjc4LDUuMDIyLDEuMTA3LDEwLjczNi01LjAwOCwxMy44NjhsLTEyLjUyNCw2LjM4NmMtNS45NzUsMi45NzctMTcuMjk4LDEuNjUzLTE5LjQzOS02LjM2NA0KCQljLTAuOTU3LTIuNzM0LTEuMzk3LTQuODk3LTIuMDQ3LTcuODI0bC0xNy45MDcsNC45OTFjLTAuNDI0LTYuNDgxLTAuNDgtNy42MTMtMC4wOTYtMTMuMTMxTDczLjI1MywxMzIuNTg3eiBNMTUwLDI1LjM2DQoJCWM0MS41MjIsMCw3NS4xODEsMzMuNjU5LDc1LjE4MSw3NS4xODJjMCw0MS41MjEtMzMuNjU4LDc1LjE3Ny03NS4xODEsNzUuMTc3Yy00MS41MjEsMC03NS4xOC0zMy42NTYtNzUuMTgtNzUuMTc3DQoJCUM3NC44Miw1OS4wMiwxMDguNDc5LDI1LjM2LDE1MCwyNS4zNiBNMTUwLDEyLjU2NmM3NS45MDMsMCwxMzcuNDMzLDYxLjUzLDEzNy40MzMsMTM3LjQzNA0KCQljMCw3NS45MDYtNjEuNTI5LDEzNy40MzYtMTM3LjQzMywxMzcuNDM2UzEyLjU2NywyMjUuOTA1LDEyLjU2NywxNTBDMTIuNTY3LDc0LjA5Niw3NC4wOTcsMTIuNTY2LDE1MCwxMi41NjYiLz4NCgk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iIzAwNjQzNyIgZD0iTTIwNS42NDUsNjAuNjM0Yy0zMi42MTctNy42NDUtNTIuNTI1LTI1LjMxMy01NS42MzgtMjguNDUxDQoJCWMtMy4wNCwzLjExLTIzLjYwNiwyMS4wMzItNTUuNTUsMjguNDUxYy0wLjYzMyw2OS44MjUsNTAuOTk3LDEwNS43MTEsNTUuNTUsMTA4Ljc3Ng0KCQlDMTU0LjUzOCwxNjYuMzg0LDIwNi4xMDMsMTMxLjc2LDIwNS42NDUsNjAuNjM0IE0xNTAuODI3LDMxLjA0MmMxNy44NTEsMTYuMDI5LDM4LjI1NCwyNC4zMDEsNTUuMjQyLDI4LjMwOQ0KCQlDMTkzLjUzMSw0Mi4zODUsMTczLjQ4LDMxLjMxLDE1MC44MjcsMzEuMDQyIE05My45LDU5LjM3NmMxNi40NzItMy44NTYsMzYuNjg2LTEyLjM0NCw1NS4yNDMtMjguMzM0DQoJCUMxMjYuNDg2LDMxLjMxNSwxMDYuNDMxLDQyLjM5OCw5My45LDU5LjM3NiBNMTQ4LjgwNCwxNzAuMzY1Yy0zNS4zMzEtMjQuNjAyLTU2Ljc3NC02OC4xNDgtNTUuODAxLTEwOS43NDgNCgkJQzg1LjAxNyw3MS45NTcsODAuMzIsODUuNzgyLDgwLjMyLDEwMC43MDdDODAuMzIsMTM4Ljc5LDExMC44NzQsMTY5LjcyOCwxNDguODA0LDE3MC4zNjUgTTIwNy4wMjksNjAuNjg5DQoJCWMxLjAxNCw0MS44NDEtMTkuNjU4LDg0LjcxNy01NS44MDgsMTA5LjY3NmMzNy45MTItMC42NTksNjguNDQzLTMxLjU5LDY4LjQ0My02OS42NTkNCgkJQzIxOS42NjUsODUuODEyLDIxNC45ODgsNzIuMDEyLDIwNy4wMjksNjAuNjg5IE0xNDkuOTkzLDI5LjIxYzM5LjM5MywwLDcxLjMzNSwzMS45MzUsNzEuMzM1LDcxLjMzNQ0KCQljMCwzOS4zOTUtMzEuOTQyLDcxLjMzMS03MS4zMzUsNzEuMzMxYy0zOS4zOTYsMC03MS4zMzQtMzEuOTM3LTcxLjMzNC03MS4zMzFDNzguNjU5LDYxLjE0NSwxMTAuNTk3LDI5LjIxLDE0OS45OTMsMjkuMjEiLz4NCgk8cGF0aCBmaWxsPSIjMDA2NDM3IiBkPSJNMTI5Ljc3MSw4Ny40MzJWNjguMzkxYzAtMy43MTgtNC4yOTMtNC43Mi03Ljc3NC00LjUwOGMzLjQzMS01LjQ2NCw4LjUyLTcuMjksMTMuMzk1LTMuMTU1DQoJCWMzLjI3LTQuNTg4LDExLjI4My0xMC45MjUsMTguODAyLTEwLjY5NGMzMy43MjIsMC41MjMsMzUuMTgsNDguOTIyLDExLjMzMiw1Ny41ODdjLTIzLjA4OSw4LjM5MS0yNi42Ni0yMS4yNS0xMi4yMjktMjAuMjMyDQoJCWM5LjQwMSwwLjgxNiw2LjQ0NiwxNi41MTUtMi4wMTMsMTEuNTgyYzMuMjk3LDkuNjI5LDI0LjQyMi0wLjIyNiwxMy42NTQtMTkuMTcxYzcuMTQ1LTcuMjgxLDAuOTM4LTIxLjgwNi05LjU3MS0yMS45NTENCgkJYy04LjkxLTAuMTI0LTEyLjY0Miw4LjIzMS0xMi42NzQsMTMuODk2bC0wLjAwNSw1My42MDljLTAuMTA3LDkuNDksMS4yNCwxNi44OTIsOS4wNjYsMjEuMDI0DQoJCWMtNy45MTMsMy43MDgtMTYuMTQzLTEuNjcyLTE3LjU5NS05Ljc5NGMtMy40MDQsMS40MzEtNi45ODYsMC40MzktOS44NTEtNC4xNjJjMi45MzItMC4zODEsNS40OTQtMi4zMDksNS40NjItNi44NDJWOTQuOTg4DQoJCWwtMy45MzYtMy43MDdMMTI5Ljc3MSw4Ny40MzJ6IE0xMjQuNjMyLDYyLjYzMmMyLjY3OS0wLjA5NSw2LjUyMSwxLjgzMiw2LjUyMSw1Ljc0NXYxOS41NzRsLTMuMzg4LDMuMzMxbDMuMzg4LDMuMTN2MzEuNjE4DQoJCWMwLDIuMjEzLTAuNTAxLDUuNjg3LTQuNDMxLDcuMTkxYzIuODYsMy40NTcsNS41NSwyLjgyOCw4LjY0MiwxLjEyYzAuNjU5LDkuNTI1LDguMjUyLDEyLjY2OCwxMy4yNzcsMTEuNTk1DQoJCWMtNi41NzYtNC44MjctNy4yNzYtMTIuNDc0LTcuMzMtMTkuMTE4VjcxLjYxNmMtMC4wMDMtNS40MzksMy43NTMtMTUuMDc4LDE0LjA4NC0xNS4wNTRjMTEuNTQ2LDAuMDI1LDE3Ljk0MSwxNS4xNjcsMTEuMTY0LDIzLjIzNg0KCQljMTEuNzk1LDIxLjgyMy0xNi4zNjksMzIuNzgxLTE3LjIxOSwxNi4zMThjOS4xNzIsNy44NDQsMTEuMzE4LTYuODEzLDMuNzM3LTcuNDMzYy0xMi4zNTQtMS4wMTMtOC41NzQsMjUuOTA4LDEyLjQ5NSwxNy40NjUNCgkJYzIxLjgzNi04LjkzNSwyMC44MjMtNTQuMDA3LTExLjM3OC01NC44NDhjLTcuNDE0LTAuMTk0LTE0LjIsNS42ODMtMTguNjMxLDExLjQyNUMxMzIuMTI3LDU5LjMyMiwxMjguNTQ4LDU4LjQ1OSwxMjQuNjMyLDYyLjYzMg0KCQkgTTE1NS4zNywxNTguNDkzaC0xMC43MTFjMi42OTksMi4yMTMsNC42MzMsMy41NTksNS4zNzMsNC4wMjRDMTUwLjcxNSwxNjIuMDUyLDE1Mi42NDYsMTYwLjcxMiwxNTUuMzcsMTU4LjQ5MyBNMTYwLjY2NiwxNTMuODg3DQoJCUgxMzkuNDFjMS42NTgsMS41NDcsMy4xOTYsMi44OTQsNC41NTksNC4wMzZoMTIuMDkzQzE1Ny40MzgsMTU2Ljc4LDE1OC45ODksMTU1LjQzNCwxNjAuNjY2LDE1My44ODcgTTE2NS4zMDgsMTQ5LjM2M2gtMzAuNDkyDQoJCWMxLjM4MSwxLjQzMywyLjcxNiwyLjc1MSwzLjk4NiwzLjk1M2gyMi40OEMxNjIuNTYxLDE1Mi4xMTQsMTYzLjkxLDE1MC43OTYsMTY1LjMwOCwxNDkuMzYzIE0xNjUuMjY4LDk4LjE0NWgxLjYzMw0KCQljLTAuMTExLDAuMTkyLTAuMjI3LDAuMzg0LTAuMzQyLDAuNTY4aC0xLjc1N0MxNjQuOTYxLDk4LjUyOSwxNjUuMTE3LDk4LjM0LDE2NS4yNjgsOTguMTQ1IE0xNTcuODA5LDk4LjE0NWg3LjQ1OQ0KCQljLTAuMTUsMC4xOTUtMC4zMDcsMC4zODQtMC40NjYsMC41NjhoLTcuNDkxQzE1Ny40OSw5OC41MzgsMTU3LjY1Nyw5OC4zNTEsMTU3LjgwOSw5OC4xNDUgTTE1Ny4yMTgsOTguMTQ1aDAuNTkxDQoJCWMtMC4xNTEsMC4yMDYtMC4zMTgsMC4zOTMtMC40OTgsMC41NjhoLTEuMDdDMTU2LjYwOSw5OC41OTMsMTU2LjkzOCw5OC4zOTUsMTU3LjIxOCw5OC4xNDUgTTE2Ny41NDYsOTMuNDU2aDEuMDA2DQoJCWMtMC4wMzIsMC4xOTItMC4wNzEsMC4zODEtMC4xMDksMC41NzFoLTEuMDU1QzE2Ny40NDUsOTMuODM3LDE2Ny40OTgsOTMuNjQ1LDE2Ny41NDYsOTMuNDU2IE0xNTkuMTAyLDkzLjQ1Nmg4LjQ0NA0KCQljLTAuMDQ4LDAuMTg5LTAuMTAxLDAuMzgxLTAuMTU4LDAuNTcxaC04LjI3MkMxNTkuMTE4LDkzLjgzNCwxNTkuMTEyLDkzLjY0NSwxNTkuMTAyLDkzLjQ1NiBNMTU4LjM0NCw5My40NTZoMC43NTgNCgkJYzAuMDExLDAuMTg5LDAuMDE3LDAuMzc5LDAuMDE0LDAuNTcxaC0wLjY4NEMxNTguNDA5LDkzLjgzNCwxNTguMzgyLDkzLjY0NSwxNTguMzQ0LDkzLjQ1NiBNMTQ1LjA1NSw5My40NTZoMC42MTUNCgkJYy0wLjA1MiwwLjE4Ny0wLjEsMC4zNzYtMC4xNCwwLjU3MWgtMC42MDJDMTQ0Ljk2Nyw5My44MzIsMTQ1LjAxLDkzLjY0MiwxNDUuMDU1LDkzLjQ1NiBNMTQyLjY5MSw5My40NTZoMi4zNjQNCgkJYy0wLjA0NSwwLjE4Ny0wLjA4OCwwLjM3Ni0wLjEyNiwwLjU3MWgtMi4yMzhWOTMuNDU2eiBNMTQxLjc2LDkzLjQ1NmgwLjkzMXYwLjU3MWgtMC45MzRMMTQxLjc2LDkzLjQ1NnogTTE2Ny45MjksODguOTE0aDAuOA0KCQljMC4wMTcsMC4xOTIsMC4wMjcsMC4zNzksMC4wMzgsMC41NjhoLTAuODA4QzE2Ny45NTQsODkuMjkzLDE2Ny45NDMsODkuMTA2LDE2Ny45MjksODguOTE0IE0xNTcuMDQ5LDg4LjkxNGgxMC44OA0KCQljMC4wMTUsMC4xOTIsMC4wMjUsMC4zNzksMC4wMywwLjU2OEgxNTcuNkMxNTcuNDI4LDg5LjI4MiwxNTcuMjQ1LDg5LjA5LDE1Ny4wNDksODguOTE0IE0xNTQuODksODguOTE0aDIuMTU5DQoJCWMwLjE5NiwwLjE3NiwwLjM3OSwwLjM2OCwwLjU1MSwwLjU2OGgtMS43NDlDMTU1LjU1NSw4OS4yNjksMTU1LjIzNiw4OS4wNzYsMTU0Ljg5LDg4LjkxNCBNMTQ3LjgzMyw4OC45MTRoMi4wNg0KCQljLTAuNDMzLDAuMTU3LTAuODI5LDAuMzUyLTEuMTk3LDAuNTY4aC0xLjQ5MkMxNDcuNCw4OS4yODIsMTQ3LjYxMSw4OS4wODcsMTQ3LjgzMyw4OC45MTQgTTE0Mi42OTEsODguOTE0aDUuMTQyDQoJCWMtMC4yMjEsMC4xNzMtMC40MzMsMC4zNjgtMC42MjksMC41NjhoLTQuNTEyVjg4LjkxNHogTTE0MS43NjUsODguOTE0aDAuOTI2djAuNTY4aC0wLjkyNlY4OC45MTR6IE0xNjYuOTc0LDg0LjI4NWgwLjg0Mw0KCQljMC4wNTgsMC4xOTIsMC4xMTIsMC4zODEsMC4xNjUsMC41NzFoLTAuODI0QzE2Ny4xMDIsODQuNjY5LDE2Ny4wMzYsODQuNDc3LDE2Ni45NzQsODQuMjg1IE0xNDIuNjkxLDg0LjI4NWgyNC4yODMNCgkJYzAuMDYzLDAuMTkyLDAuMTI4LDAuMzg0LDAuMTg0LDAuNTcxaC0yNC40NjZWODQuMjg1eiBNMTQxLjc3NCw4NC4yODVoMC45MTd2MC41NzFoLTAuOTE3Vjg0LjI4NXogTTE2NS4wNDksNzkuNjhoMS4xNTgNCgkJYy0wLjA1MiwwLjA2MS0wLjEwNCwwLjEyMi0wLjE1NSwwLjE3OWMwLjA2NSwwLjEzMiwwLjEyMywwLjI2MSwwLjE4NiwwLjM5M2gtMS4wNTJjLTAuMDgyLTAuMTUxLTAuMTU4LTAuMzAyLTAuMjQ2LTAuNDUzDQoJCUMxNjQuOTc4LDc5Ljc2LDE2NS4wMTEsNzkuNzIyLDE2NS4wNDksNzkuNjggTTE0Mi42OTQsNzkuNjhoMjIuMzU1Yy0wLjAzOCwwLjA0Mi0wLjA3MSwwLjA4MS0wLjEwOSwwLjExOQ0KCQljMC4wODgsMC4xNTEsMC4xNjQsMC4zMDIsMC4yNDYsMC40NTNoLTIyLjQ5MlY3OS42OHogTTE0MS43ODIsNzkuNjhoMC45MTJ2MC41NzJoLTAuOTEyVjc5LjY4eiBNMTY3LjYxMyw3NS4wNTdoMC45MTENCgkJYy0wLjA0MSwwLjE4OS0wLjA4NywwLjM3OS0wLjE0MiwwLjU2OGgtMC45MzVDMTY3LjUwOSw3NS40MzYsMTY3LjU2NCw3NS4yNDYsMTY3LjYxMyw3NS4wNTcgTTE0Mi42OTQsNzUuMDU3aDI0LjkxOQ0KCQljLTAuMDQ5LDAuMTg5LTAuMTA0LDAuMzc5LTAuMTY1LDAuNTY4aC0yNC43NTRWNzUuMDU3eiBNMTQxLjc5MSw3NS4wNTdoMC45MDN2MC41NjhoLTAuOTAzVjc1LjA1N3ogTTE2Ny45MjMsNzAuNDVoMC44MTINCgkJYzAuMDE5LDAuMTg5LDAuMDM3LDAuMzgyLDAuMDU0LDAuNTY4aC0wLjgxM0MxNjcuOTY1LDcwLjgzMiwxNjcuOTQzLDcwLjYzOSwxNjcuOTIzLDcwLjQ1IE0xNDIuNzYxLDcwLjQ1aDI1LjE2Mg0KCQljMC4wMjEsMC4xODksMC4wNDIsMC4zODIsMC4wNTMsMC41NjhoLTI1LjI2QzE0Mi43MjcsNzAuODM0LDE0Mi43NDMsNzAuNjQyLDE0Mi43NjEsNzAuNDUgTTE0MS44MjUsNzAuNDVoMC45MzcNCgkJYy0wLjAxOCwwLjE5Mi0wLjAzNSwwLjM4NC0wLjA0NiwwLjU2OGgtMC45MTdDMTQxLjgwMSw3MC44MzQsMTQxLjgxLDcwLjY0MiwxNDEuODI1LDcwLjQ1IE0xNjYuNjI4LDY1LjgyM2gwLjg3DQoJCWMwLjA4LDAuMTg3LDAuMTU2LDAuMzc5LDAuMjMsMC41NzFoLTAuODU0QzE2Ni43OTQsNjYuMjAyLDE2Ni43MTUsNjYuMDEsMTY2LjYyOCw2NS44MjMgTTE0My45MTgsNjUuODIzaDIyLjcxDQoJCWMwLjA4NywwLjE4NywwLjE2NiwwLjM3OSwwLjI0NywwLjU3MWgtMjMuMTc4QzE0My43NjcsNjYuMjAyLDE0My44NCw2Ni4wMTUsMTQzLjkxOCw2NS44MjMgTTE0Mi45NDksNjUuODIzaDAuOTY5DQoJCWMtMC4wNzgsMC4xOTItMC4xNTEsMC4zNzktMC4yMjEsMC41NzFoLTAuOTc2QzE0Mi43OTQsNjYuMjAyLDE0Mi44NzEsNjYuMDE1LDE0Mi45NDksNjUuODIzIE0xNjMuMzU5LDYxLjIxOWgxLjMxMQ0KCQljMC4xNjEsMC4xODcsMC4zMTUsMC4zNzYsMC40NjYsMC41NjhoLTEuMjFDMTYzLjc0MSw2MS41OTUsMTYzLjU1Niw2MS40MDMsMTYzLjM1OSw2MS4yMTkgTTE0Ni44OTksNjEuMjE5aDE2LjQ2DQoJCWMwLjE5NiwwLjE4NCwwLjM4MiwwLjM3NiwwLjU2NiwwLjU2OGgtMTcuNTU1QzE0Ni41NDIsNjEuNTk1LDE0Ni43MTYsNjEuNDAzLDE0Ni44OTksNjEuMjE5IE0xNDUuOTY2LDYxLjIxOWgwLjkzMw0KCQljLTAuMTgzLDAuMTg0LTAuMzU3LDAuMzc2LTAuNTI4LDAuNTY4aC0wLjkyMkMxNDUuNjE1LDYxLjU5NSwxNDUuNzg2LDYxLjQwNiwxNDUuOTY2LDYxLjIxOSBNMTUwLjkzOCwxMDcuMzc2aDMuNTY3DQoJCWMwLjk4OCwwLjI5NCwyLjA0OCwwLjQ5MiwzLjE3OSwwLjU2OGgtNS42MzRDMTUxLjY2NiwxMDcuNzcxLDE1MS4yOTYsMTA3LjU3OSwxNTAuOTM4LDEwNy4zNzYgTTE0Mi42OTEsMTA3LjM3Nmg4LjI0OA0KCQljMC4zNTcsMC4yMDMsMC43MjgsMC4zOTYsMS4xMTIsMC41NjhoLTkuMzZWMTA3LjM3NnogTTE0MS43MzQsMTA3LjM3NmgwLjk1N3YwLjU2OGgtMC45NkwxNDEuNzM0LDEwNy4zNzZ6IE0xNDYuNDE4LDEwMi43NWgxLjM5Nw0KCQljMC4xNDcsMC4xOTIsMC4zMDEsMC4zODIsMC40NjIsMC41NjloLTEuNTIxQzE0Ni42MzgsMTAzLjEzMSwxNDYuNTI1LDEwMi45NDIsMTQ2LjQxOCwxMDIuNzUgTTE0Mi42OTEsMTAyLjc1aDMuNzI4DQoJCWMwLjEwNywwLjE5MiwwLjIxOSwwLjM4MiwwLjMzNywwLjU2OWgtNC4wNjVWMTAyLjc1eiBNMTQxLjc0MiwxMDIuNzVoMC45NDl2MC41NjloLTAuOTUxTDE0MS43NDIsMTAyLjc1eiBNMTQ0Ljg1NCw5OC4xNDVoMC43OA0KCQljMC4wNDUsMC4xODcsMC4wOTIsMC4zNzksMC4xNDgsMC41NjhoLTAuODI5QzE0NC45MTgsOTguNTI0LDE0NC44ODMsOTguMzMyLDE0NC44NTQsOTguMTQ1IE0xNDIuNjkxLDk4LjE0NWgyLjE2NA0KCQljMC4wMjksMC4xODcsMC4wNjMsMC4zNzksMC4wOTksMC41NjhoLTIuMjYzVjk4LjE0NXogTTE0MS43NTIsOTguMTQ1aDAuOTM5djAuNTY4aC0wLjk0MkwxNDEuNzUyLDk4LjE0NXogTTE2NS44OTUsNTIuNTU4aC0wLjkyOA0KCQljLTAuNTMzLTAuMjA0LTEuMDc3LTAuMzk5LTEuNjM3LTAuNTY5aDEuMjI5QzE2NS4wMTcsNTIuMTY4LDE2NS40NTgsNTIuMzU2LDE2NS44OTUsNTIuNTU4IE0xNzIuNjc5LDU3LjE2M2gtMC4yNzINCgkJYy0wLjIwOC0wLjE5My0wLjQyLTAuMzg1LTAuNjM2LTAuNTcxaDAuMjg0QzE3Mi4yNjIsNTYuNzgsMTcyLjQ3Nyw1Ni45NjYsMTcyLjY3OSw1Ny4xNjMgTTE3Ni41MDksNjEuNzg3aC0wLjE3OA0KCQljLTAuMTI3LTAuMTg5LTAuMjQ4LTAuMzgxLTAuMzgzLTAuNTY4aDAuMTc0QzE3Ni4yNTIsNjEuNDA4LDE3Ni4zODMsNjEuNTk4LDE3Ni41MDksNjEuNzg3IE0xNzguOTcsNjYuMzk0aC0wLjE4Mw0KCQljLTAuMDgyLTAuMTkyLTAuMTY5LTAuMzc5LTAuMjUxLTAuNTcxaDAuMThDMTc4LjgwMiw2Ni4wMTUsMTc4Ljg4OCw2Ni4yMDIsMTc4Ljk3LDY2LjM5NCBNMTgwLjU0OCw3MS4wMThoLTAuMjI0DQoJCWMtMC4wNDgtMC4xODctMC4xMDEtMC4zNzktMC4xNTMtMC41NjhoMC4yMjFDMTgwLjQ0Myw3MC42MzksMTgwLjQ5Niw3MC44MzIsMTgwLjU0OCw3MS4wMTggTTE4MS40Myw3NS42MjVoLTAuMjcNCgkJYy0wLjAyMi0wLjE4OS0wLjA0OC0wLjM4MS0wLjA3MS0wLjU2OGgwLjI2M0MxODEuMzc3LDc1LjI0NCwxODEuNDA0LDc1LjQzNiwxODEuNDMsNzUuNjI1IE0xODEuNzEyLDgwLjI1MWgtMC4zMTYNCgkJYzAuMDAzLTAuMTkyLDAuMDAzLTAuMzc4LDAuMDAzLTAuNTcyaDAuMzEzQzE4MS43MTQsNzkuODczLDE4MS43MTIsODAuMDYsMTgxLjcxMiw4MC4yNTEgTTE4MS40Myw4NC44NTZoLTAuMzYzDQoJCWMwLjAyMi0wLjE4OSwwLjA1Mi0wLjM3OSwwLjA3NC0wLjU3MWgwLjM1NEMxODEuNDc2LDg0LjQ3NywxODEuNDUxLDg0LjY2NywxODEuNDMsODQuODU2IE0xODAuNTQ4LDg5LjQ4MmgtMC40MTQNCgkJYzAuMDU1LTAuMTg5LDAuMTA4LTAuMzc4LDAuMTUzLTAuNTY4aDAuNEMxODAuNjM5LDg5LjEwNCwxODAuNTk1LDg5LjI5MywxODAuNTQ4LDg5LjQ4MiBNMTc5LjAxLDk0LjAyNmgtMC40NjYNCgkJYzAuMDc5LTAuMTkyLDAuMTY3LTAuMzgxLDAuMjQ2LTAuNTcxaDAuNDUxQzE3OS4xNjQsOTMuNjQ1LDE3OS4wODksOTMuODM3LDE3OS4wMSw5NC4wMjYgTTE3Ni41MDMsOTguNzEzaC0wLjU2DQoJCWMwLjEyNi0wLjE4NywwLjI1OC0wLjM3OSwwLjM4Mi0wLjU2OGgwLjU1MkMxNzYuNzU3LDk4LjMzNywxNzYuNjI1LDk4LjUyNCwxNzYuNTAzLDk4LjcxMyBNMTcyLjU5MSwxMDMuMzE4aC0wLjg0NQ0KCQljMC4yMjItMC4xODQsMC40NDEtMC4zNzQsMC42Ni0wLjU2OWgwLjc4OEMxNzMsMTAyLjk0NSwxNzIuNzk2LDEwMy4xMzEsMTcyLjU5MSwxMDMuMzE4IE0xNjQuNTc3LDEwNy45NDRoLTQuNjINCgkJYzEuMTEtMC4wNzQsMi4yOC0wLjI2MSwzLjUwMi0wLjU2OGgyLjY4OGMtMC4yMDksMC4wOC0wLjQxMSwwLjE2Ny0wLjYyLDAuMjQ0QzE2NS4yMDUsMTA3LjczOCwxNjQuODg5LDEwNy44NDYsMTY0LjU3NywxMDcuOTQ0DQoJCSBNMTQyLjY5MSwxMTIuNTUyaC0wLjk2OGwwLjAwMi0wLjU3MWgwLjk2NVYxMTIuNTUyeiBNMTQyLjY4OCwxMTcuMTc1aC0wLjk3MXYtMC41NzFoMC45NzNMMTQyLjY4OCwxMTcuMTc1eiBNMTQyLjY4OCwxMjEuNzgzDQoJCWgtMC45Nzl2LTAuNTcyaDAuOTc5VjEyMS43ODN6IE0xNDIuNjgxLDEyNi4yOTZoLTAuOTh2LTAuNTcxaDAuOTgzQzE0Mi42ODEsMTI1LjkxNywxNDIuNjgxLDEyNi4xMDYsMTQyLjY4MSwxMjYuMjk2DQoJCSBNMTQyLjg0OCwxMzAuOTAxaC0xLjE0NmwtMC4wMS0wLjA4M3YtMC40ODZoMS4xMTVDMTQyLjgxNywxMzAuNTIyLDE0Mi44MzEsMTMwLjcxNSwxNDIuODQ4LDEzMC45MDEgTTE0My41NDUsMTM1LjUyN2gtMC45OTgNCgkJYy0wLjA1Mi0wLjE4OS0wLjEwMi0wLjM3OS0wLjE0OC0wLjU2OGgxLjAyQzE0My40NTgsMTM1LjE1MSwxNDMuNSwxMzUuMzM4LDE0My41NDUsMTM1LjUyNyBNMTQ1LjI2NCwxNDAuMTMyaC0wLjk3OQ0KCQljLTAuMDk2LTAuMTg3LTAuMTg4LTAuMzc5LTAuMjc4LTAuNTcxaDAuOTZDMTQ1LjA2MSwxMzkuNzU2LDE0NS4xNTksMTM5Ljk0NiwxNDUuMjY0LDE0MC4xMzIgTTE0OS4yMjIsMTQ0Ljc2MWgtMS41MjQNCgkJYy0wLjIwMi0wLjE4Ny0wLjM5Ny0wLjM3NC0wLjU4Ny0wLjU3MWgxLjQxMUMxNDguNzQ3LDE0NC4zODIsMTQ4Ljk4LDE0NC41NzQsMTQ5LjIyMiwxNDQuNzYxIE0xMzguMjM4LDE0NC4xOWgxLjIzOQ0KCQljMC4yMDIsMC4xOTcsMC40MTMsMC4zODQsMC42MjksMC41NzFoLTEuMjIyQzEzOC42NjUsMTQ0LjU3NywxMzguNDQ3LDE0NC4zODcsMTM4LjIzOCwxNDQuMTkgTTEzNS4wNDEsMTM5LjU2MWgxLjI0NQ0KCQljMC4wODMsMC4xODksMC4xNzIsMC4zODEsMC4yNjgsMC41NzFoLTEuMjZDMTM1LjIwNywxMzkuOTQ2LDEzNS4xMjEsMTM5Ljc1NiwxMzUuMDQxLDEzOS41NjEgTTEyNi4zMDgsMTM0Ljk1OWgxLjI1NQ0KCQljMC4yOSwwLjE5NywwLjU4OCwwLjM4NywwLjkwMSwwLjU2OGgtMS41MjFDMTI2LjcyOSwxMzUuMzUyLDEyNi41MTYsMTM1LjE2NSwxMjYuMzA4LDEzNC45NTkgTTEyOC4zNDQsMTMwLjMzM2gxLjY2NA0KCQljLTAuMDI0LDAuMTU0LTAuMDUzLDAuMjk2LTAuMDg2LDAuNDMxYy0wLjAzMiwwLjA0Ni0wLjA2MywwLjA5NC0wLjA5NywwLjEzOGgtMi4wMjINCgkJQzEyNy45OTUsMTMwLjcyOCwxMjguMTc1LDEzMC41MzYsMTI4LjM0NCwxMzAuMzMzIE0xMjkuNzcxLDEyNS43MjVoMC4zNTFsLTAuMDAyLDAuNTcxaC0wLjM2OA0KCQlDMTI5Ljc2NCwxMjYuMTEyLDEyOS43NjksMTI1LjkyMiwxMjkuNzcxLDEyNS43MjUgTTEyOS43NzEsMTIxLjIxMWgwLjM1N3YwLjU3MmgtMC4zNTdWMTIxLjIxMXogTTEyOS43NzEsMTE2LjYwNGgwLjM2NXYwLjU3MQ0KCQloLTAuMzY1VjExNi42MDR6IE0xMjkuNzcxLDExMS45OGgwLjM3NGwtMC4wMDMsMC41NzFoLTAuMzcxVjExMS45OHogTTEyOS43NzEsMTA3LjM3NmgwLjM4djAuNTY4aC0wLjM4VjEwNy4zNzZ6IE0xMjkuNzcxLDEwMi43NQ0KCQloMC4zODh2MC41NjloLTAuMzg4VjEwMi43NXogTTEyOS43NzEsOTguMTQ1aDAuMzk3bC0wLjAwMywwLjU2OGgtMC4zOTRWOTguMTQ1eiBNMTI4LjE0Myw5My40NTZoMC44MzlsMC41MDIsMC41NzFoLTAuNzM2DQoJCUwxMjguMTQzLDkzLjQ1NnogTTEyOS43NzEsODQuMjg1aDAuMzgzdjAuNTcxaC0wLjM4M1Y4NC4yODV6IE0xMjkuNzcxLDc5LjY4aDAuMzk0djAuNTcyaC0wLjM5NFY3OS42OHogTTEyOS43NzEsNzUuMDU3aDAuNDA1DQoJCWwtMC4wMDIsMC41NjhoLTAuNDAyVjc1LjA1N3ogTTEyOS43NzEsNzAuNDVoMC40MTN2MC41NjhoLTAuNDEzVjcwLjQ1eiBNMTI4LjgzLDY1LjgyM2gxLjIyYzAuMDU0LDAuMTc5LDAuMDkyLDAuMzcxLDAuMTE2LDAuNTcxDQoJCWgtMC45MTdDMTI5LjEyNyw2Ni4xODgsMTI4Ljk4Nyw2NS45OTksMTI4LjgzLDY1LjgyMyBNMTI0LjA4MSw2MS4yMTloMC45NDJjLTAuMTcxLDAuMTgxLTAuMzQxLDAuMzcxLTAuNTA5LDAuNTY4aC0wLjk2NA0KCQlDMTIzLjcyNCw2MS41OTIsMTIzLjkwMSw2MS40LDEyNC4wODEsNjEuMjE5IE0xMzkuMTk5LDU2LjU5MmgxLjYzOWMtMC4yMDYsMC4xODgtMC40MSwwLjM3Ny0wLjYwOSwwLjU3MWgtMS42NTQNCgkJQzEzOC43NzcsNTYuOTcyLDEzOC45ODQsNTYuNzgsMTM5LjE5OSw1Ni41OTIgTTE0Ni4wNDUsNTEuOTg4aDEuNTU2Yy0wLjQwNywwLjE3Mi0wLjgwOCwwLjM2NS0xLjIwNSwwLjU2OWgtMS40NjcNCgkJQzE0NS4yOTYsNTIuMzU5LDE0NS42Nyw1Mi4xNjgsMTQ2LjA0NSw1MS45ODggTTE2MS41OSw0Ny45M2gtMjMuNDU0Yy0yLjAzMywxLjMwOC00LjMsMi42NzctNi43NzYsNC4wNTloMTQuNjg2DQoJCWMtMC4zNzUsMC4xOC0wLjc0OSwwLjM3MS0xLjExNiwwLjU2OWgtMTQuNjA0Yy0yLjQ5MywxLjM1Ny01LjE4OSwyLjcyLTguMDczLDQuMDM1aDE2Ljk0N2MtMC4yMTQsMC4xODgtMC40MjEsMC4zOC0wLjYyNSwwLjU3MQ0KCQloLTE3LjU5MWMtMy4yNDEsMS40MzctNi43MDgsMi44MDktMTAuMzc3LDQuMDU2aDEzLjQ3NmMtMC4xOCwwLjE4MS0wLjM1NywwLjM3My0wLjUzMSwwLjU2OGgtMTQuNjY2DQoJCWMtMi43ODgsMC45LTUuNjksMS43MjQtOC42OTMsMi40NDFjLTAuMDAyLDAuNTM1LDAsMS4wNjUsMC4wMDUsMS41OTVoMjguNjMzYzAuMTU4LDAuMTc2LDAuMjk4LDAuMzY1LDAuNDE4LDAuNTcxaC0yOS4wNDMNCgkJYzAuMDIzLDEuMzY1LDAuMDY0LDIuNzE5LDAuMTI5LDQuMDU2aDI5LjQzOHYwLjU2OGgtMjkuNDA5YzAuMDcsMS4zNjEsMC4xNjQsMi43MDcsMC4yNzksNC4wMzloMjkuMTI5djAuNTY4aC0yOS4wODMNCgkJYzAuMTI1LDEuMzY3LDAuMjcsMi43MjEsMC40MzQsNC4wNTVoMjguNjQ5djAuNTcyaC0yOC41NzdjMC4xNzQsMS4zNjIsMC4zNzEsMi43MDcsMC41ODgsNC4wMzRoMjcuOTg5djAuNTcxaC0yNy44OTMNCgkJYzAuMjMsMS4zNzEsMC40OCwyLjcyNCwwLjc1Myw0LjA1OGgyNS43MmgxLjYwNWgwLjIxN2wtMC41OCwwLjU2OGgtMC4zNjJoLTEuNDg4SDEwMi43NWMwLjI4LDEuMzQzLDAuNTgyLDIuNjY5LDAuODk5LDMuOTczDQoJCWgyNC40OTRsMC42MDUsMC41NzFoLTI0Ljk1NWMwLjM0OCwxLjM5NiwwLjcyLDIuNzY1LDEuMTA5LDQuMTE5aDI0Ljg2OXYwLjU2OGgtMjQuNzAzYzAuNDAyLDEuMzY4LDAuODI3LDIuNzEzLDEuMjY5LDQuMDM2aDIzLjQzNA0KCQl2MC41NjloLTIzLjI0M2MwLjQ2OSwxLjM3OCwwLjk1NiwyLjcyOSwxLjQ2Miw0LjA1OGgyMS43ODF2MC41NjhIMTA4LjIxYzAuNTI5LDEuMzcsMS4wNzksMi43MTgsMS42NDUsNC4wMzZoMTkuOTE3djAuNTcxaC0xOS42NjkNCgkJYzAuNjAxLDEuMzgxLDEuMjIsMi43MzIsMS44NTgsNC4wNTJoMTcuODExdjAuNTcxaC0xNy41MzVjMC42NjgsMS4zNzgsMS4zNTUsMi43MjEsMi4wNTgsNC4wMzZoMTUuNDc3djAuNTcySDExNC42DQoJCWMwLjczLDEuMzQ1LDEuNDczLDIuNjYxLDIuMjI5LDMuOTQyaDEyLjk0MmMtMC4wMDIsMC4xOTctMC4wMDgsMC4zODctMC4wMiwwLjU3MWgtMTIuNTg0YzAuODI2LDEuMzgzLDEuNjY0LDIuNzI5LDIuNTEzLDQuMDM2DQoJCWg4LjY2M2MtMC4xNjksMC4yMDQtMC4zNDksMC4zOTYtMC41NDEsMC41NjloLTcuNzUxYzAuOTIsMS4zOTcsMS44NTEsMi43NSwyLjc4NSw0LjA1OGgzLjQ3MmMwLjIwOCwwLjIwNiwwLjQyMSwwLjM5MywwLjYzNSwwLjU2OA0KCQloLTMuN2MxLjAxMiwxLjQsMi4wMjYsMi43NDMsMy4wMzgsNC4wMzRoOC43NTljMC4wODEsMC4xOTUsMC4xNjYsMC4zODUsMC4yNTIsMC41NzFoLTguNTYxYzEuMTI2LDEuNDE5LDIuMjUyLDIuNzcyLDMuMzU5LDQuMDU4DQoJCWg4LjE0NmMwLjIwOSwwLjE5NywwLjQyNywwLjM4NywwLjY0NiwwLjU3MWgtOC4yOTRjMS4yNDgsMS40MjgsMi40NzksMi43NzMsMy42ODEsNC4wMzRoMzEuNTg1DQoJCWMxLjIxMS0xLjI2LDIuNDQ5LTIuNjA1LDMuNzEzLTQuMDM0aC0yMC4zNDdjLTAuMjQyLTAuMTg3LTAuNDc1LTAuMzc5LTAuNzAxLTAuNTcxaDIxLjU0NmMxLjExNy0xLjI4NSwyLjI0Ni0yLjYzOCwzLjM4My00LjA1OA0KCQloLTI4LjE4N2MtMC4xMDUtMC4xODctMC4yMDMtMC4zNzYtMC4yOTctMC41NzFoMjguOTMzYzEuMDIyLTEuMjkxLDIuMDQ0LTIuNjMzLDMuMDYtNC4wMzRoLTMzLjQxNA0KCQljLTAuMDQ1LTAuMTg5LTAuMDg2LTAuMzc2LTAuMTI2LTAuNTY4aDMzLjk1MWMwLjkzNi0xLjMwNywxLjg2OS0yLjY2MSwyLjc4Ni00LjA1OGgtMzcuMzA4Yy0wLjAxNy0wLjE4Ny0wLjAzLTAuMzc5LTAuMDQyLTAuNTY5DQoJCWgzNy43MjVjMC44NDktMS4zMDcsMS42ODgtMi42NTMsMi41MTktNC4wMzZoLTQwLjM2OWMwLTAuMTksMC0wLjM3OSwwLjAwMy0wLjU3MWg0MC42OTljMC43NTktMS4yNzksMS41LTIuNTk0LDIuMjI4LTMuOTQyDQoJCWgtNDIuOTIydi0wLjU3Mmg0My4yMjljMC43MDEtMS4zMTUsMS4zODctMi42NTgsMi4wNTItNC4wMzZoLTQ1LjI4MWwwLjAwMi0wLjU3MWg0NS41NTJjMC42MzUtMS4zMiwxLjI1My0yLjY3MSwxLjg1MS00LjA1Mg0KCQloLTQ3LjQwM3YtMC41NzFoNDcuNjQ2YzAuNTY0LTEuMzE4LDEuMTExLTIuNjY3LDEuNjM2LTQuMDM2aC0yNy4zOTZjMC4zMTItMC4wOTksMC42MjgtMC4yMDYsMC45NDktMC4zMjQNCgkJYzAuMjA5LTAuMDc3LDAuNDExLTAuMTY1LDAuNjItMC4yNDRoMjYuMDQ2YzAuNDk5LTEuMzI5LDAuOTgxLTIuNjgsMS40NDQtNC4wNThoLTIxLjA0NmMwLjIwNS0wLjE4NywwLjQwOS0wLjM3NCwwLjYwNC0wLjU2OQ0KCQloMjAuNjM0YzAuNDM3LTEuMzIzLDAuODU2LTIuNjY4LDEuMjUyLTQuMDM2aC0xOC41NzdjMC4xMjItMC4xODksMC4yNTQtMC4zNzYsMC4zNzQtMC41NjhoMTguMzY4DQoJCWMwLjM4NS0xLjM1NCwwLjc1Mi0yLjcyMywxLjA5Ni00LjExOUgxNzkuMDFjMC4wNzktMC4xODksMC4xNTQtMC4zODEsMC4yMzEtMC41NzFoMTcuMjM3YzAuMzE1LTEuMzA0LDAuNjEyLTIuNjMsMC44ODYtMy45NzMNCgkJaC0xNi44MTZjMC4wNDctMC4xODksMC4wOTEtMC4zNzgsMC4xNC0wLjU2OGgxNi43OTJjMC4yNjctMS4zMzQsMC41MTQtMi42ODgsMC43NC00LjA1OGgtMTYuNzkNCgkJYzAuMDIxLTAuMTg5LDAuMDQ2LTAuMzc5LDAuMDY0LTAuNTcxaDE2LjgxNWMwLjIxNS0xLjMyNywwLjQwMy0yLjY3MiwwLjU3Ni00LjAzNGgtMTcuMTc0YzAtMC4xOTIsMC4wMDItMC4zNzgsMC0wLjU3MmgxNy4yNA0KCQljMC4xNTktMS4zMzQsMC4zMDItMi42ODgsMC40MTctNC4wNTVIMTgxLjQzYy0wLjAyNS0wLjE4OS0wLjA1My0wLjM4MS0wLjA3OC0wLjU2OGgxOC4wNjdjMC4xMDgtMS4zMzIsMC4xOTctMi42NzcsMC4yNjQtNC4wMzkNCgkJaC0xOS4xMzVjLTAuMDUyLTAuMTg3LTAuMTA0LTAuMzc5LTAuMTU2LTAuNTY4aDE5LjMxOGMwLjA2MS0xLjMzNywwLjA5OC0yLjY5MSwwLjExNS00LjA1NkgxNzguOTcNCgkJYy0wLjA4Mi0wLjE5Mi0wLjE2OC0wLjM3OS0wLjI1NC0wLjU3MWgyMS4xMTVjMC4wMDUtMC41MywwLjAwNS0xLjA2LDAuMDA1LTEuNTk1Yy0zLjA4Ny0wLjcyMi02LjA0Ni0xLjU0Ni04Ljg3NS0yLjQ0MWgtMTQuNDUyDQoJCWMtMC4xMjYtMC4xODktMC4yNTctMC4zNzktMC4zODctMC41NjhoMTMuMDgzYy0zLjc1Ni0xLjI1LTcuMjY4LTIuNjI1LTEwLjUyOS00LjA1NmgtNS45OTdjLTAuMjAyLTAuMTk3LTAuNDE3LTAuMzgzLTAuNjI0LTAuNTcxDQoJCWg1LjM0MWMtMi45MDctMS4zMTgtNS42MDMtMi42OC04LjA4LTQuMDM1aC0zLjQyMWMtMC40MzctMC4yMDItMC44NzgtMC4zOS0xLjMzNS0wLjU2OWgzLjcyOQ0KCQlDMTY1LjgyLDUwLjYwNywxNjMuNTg1LDQ5LjIzOCwxNjEuNTksNDcuOTMgTTE1NS4xMTIsNDMuMzI1aC0xMC4zNDRjLTEuNTk5LDEuMjA4LTMuNTI1LDIuNTc5LTUuNzUyLDQuMDM4aDIxLjcxMw0KCQlDMTU4LjU0NSw0NS45MDQsMTU2LjY2Niw0NC41MywxNTUuMTEyLDQzLjMyNSBNMTQ1LjUxNiw0Mi43NTdoOC44NjljLTIuMjU3LTEuNzk4LTMuNzM4LTMuMTY3LTQuMzc5LTMuODI5DQoJCUMxNDkuMzgyLDM5LjU4NSwxNDcuODUzLDQwLjk1NywxNDUuNTE2LDQyLjc1NyBNMjAxLjE3OSw2My4yMmMxLjI0OSwzOC41LTE4LjUyMiw3OC42MDYtNTEuMTczLDEwMS4yMTUNCgkJYy0zMS44NzQtMjIuMjQ2LTUyLjM2NS02Mi45NjItNTEuMTU4LTEwMS4yMDhjMTQuODAzLTMuNDQ2LDM0LjM4Ny0xMS4wNDcsNTEuMTU1LTI2LjE3DQoJCUMxNjYuMTE3LDUyLjIzMiwxODUuODk0LDU5LjYyNCwyMDEuMTc5LDYzLjIyIi8+DQo8L2c+DQo8L3N2Zz4NCg==';

const generatePdf = async (name, { title, subTitle, userName, options, landscape, margin = { top: '90px', bottom: '50px', right: '30px', left: '30px' } }) => {
  let template = String(fs.readFileSync(require.resolve(`../resources/report/${name}.html`))),
    html = _.template(template)({ ...options }),
    browser = await puppeteer.launch({ args: ['--no-sandbox', '--disable-setuid-sandbox'] }),
    page = await browser.newPage(),
    dtGen = `${format(new Date(), 'dd/MM/yyyy')} às ${format(new Date(), 'HH:mm:ss')}`;

  await page.setContent(html);

  const pdf = await page.pdf({
    landscape,
    margin,
    format: 'A4',
    printBackground: true,
    displayHeaderFooter: true,
    headerTemplate: `<div id="header-template" style="width:100%; position:relative; margin:0 !important; padding:0 !important;">
      <img height="50" style="position:absolute; z-index:2; top:0px; left:25px;" src="${logoPalmeiras}" />
      <div style="z-index:3; display:block; margin-top:10px; line-height: 15px; text-align:center; font-size:12px !important; color:#008000; font-weight:bold; font-family:Arial;">
        ${title}
        <div style="margin-top:5px; line-height: 13px; text-align:center; font-size:9px !important; color:#008000; font-family:Arial;">
          ${subTitle}
        </div>
      </div>
    </div>`,
    footerTemplate: `<div id="header-template" style="width:100%; position:relative; margin:0 !important; padding:0 !important; font-size:8px !important; color:#008000; font-family:Arial;">
      <div style="float:left; display:block; margin-left:25px;">
        Emitido por ${userName} em ${dtGen}
      </div>
      <div style="float:right; display:block; margin-right:25px;">
        <span class="pageNumber"></span> / <span class="totalPages"></span>
      </div>
    </div>`
  });
  await browser.close();

  const buffer = Buffer.from(pdf);
  const bufferStream = new stream.PassThrough();
  bufferStream.end(buffer);

  return { buffer, stream: bufferStream };
};

const getRnd = () => {
  return Number((Math.random() * (10000.12 - 1000.02) + 1000.02).toFixed(2));
}

export const generateSummaryReport = async (params, user) => {
  const mapMessage = {
    'taxDate': 'Vendas',
    'refDate': 'Lançamentos',
    'dueDate': 'Vencimentos',
  };
  let dateField = _.get(params, 'dateField') || 'taxDate',
    timeText = `Período de ${mapMessage[dateField]} de ${formats.dateTimeZone(params.startDate)} até ${formats.dateTimeZone(params.endDate)}`,
    tagsText = _.isEmpty(params.tags) ? '' : `- Tags: ${params.tags.join(', ')}`,
    title = `Resumo de Contabilizações`,
    subTitle = `${timeText} ${tagsText}`,
    options = { total: {}, formats },
    userData = await postgres.User.findOne({ where: { id: _.get(user, 'id', '') }, attributes: [ 'name' ]}),
    userName = _.get(userData, 'name', '');

  let tags = params.tags || [],
    startDate = _.get(params, 'startDate') || format(new Date(), 'yyyy-MM-dd'),
    endDate = _.get(params, 'endDate') || format(new Date(), 'yyyy-MM-dd');

  if (!_.isEmpty(tags) && !user.profileId !== 1) {
    tags = _.intersection(tags, user.tags);
  } else if (_.isEmpty(tags) && !user.profileId !== 1) {
    tags = user.tags;
  }
  let rows = await postgres.JournalVoucher.listPdfSummary(dateField, startDate, endDate, tags);

  options.groups = _.groupBy(rows, 'group');

  return generatePdf('dashboard-summary', {
      title,
      subTitle,
      userName,
      options,
      landscape: false,
      margin: { top: '90px', bottom: '50px', right: '40px', left: '40px' }
    });
};
